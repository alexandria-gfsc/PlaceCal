env:
  global:
    - CC_TEST_REPORTER_ID=7e0e573cd74e3418226d922174406b38d5692b01d6464701fa57ce51e75eb72a
    - secure: ZE9+HtzVkmD2MraxChjHpxNRtTdsYbMYvf/5LXI68ohCpAvO+toWohFyLjYkBVdSUMQ1u3YbW+EKiZ4lpKMOp+k7ZjlUoiKi1dBSBwUxDzPww/3PrwcMZiCI2HbwsyboYnJRt9pitcXvzfnIXRLnkfU+5LHzn5rLEa8Y9rt0VeZqdm9d2eRrsmD92l2dZg/6Ao+YrCuweOu+3gTMiA3WbxYiRNw6wuFfJ+7iwRroubAi2HRp3soOdZmFxOfUIcKrrc4UQOuIm3yQfb05ZvydlW70hxn//j6r22HuBV8G3LxNS0mRgA05JwltTwjFnDWbXCNwecQ23QsWIzqgBR0vXwJK+6dnSv3rU42YFLCEnKYDHNPtnAMEYO8OhIVMjwou6r5D5N8V/u9rFVUQUVrGiAg20cubcJeiQsP4R2R1JIImA2gN3zWW272Q7ybzZkNSOVtWu2QQiH7UtFCU1aNrg5A+Ppy15phVN2JzRXc5n0eo8j9LYZYJ8UEl5zXw37K0J8Pan9oHTmV/cNDhTE8NhaT4JgRB1LsCF2oJi5jFghkhON0W73GN76GYxetgYcE1bJ1iheY4PIto4fB3lY2Q3Knhdlv9/PlcTcEbD1+mUWRzKG8tke7R6aXyzfad6ohl7JSeo7zrCCb0pTvbUw6OdEvUNaVubP8gMFsIWktsuM8=
    - secure: "evPbFjlCicg8kmWm62snzskprlPhjDjXL1g22CcEqxLKJQ5yl4nC/C5EoMISUc7ZmmsIDrWSeDY0Th20BJMvActEYoKgbPMMqxRDO/pStxg4islNRiq19+lyrnX+zvlvMldfioyQD4FMIN6t4vi75ZSO22ZCLLmSrBWLHVGWPJZRCSTnWisWTqd64b0ENJaMK3IQ7TCH/uVENLFf/7tjwRlrdLG4L70tzBGpkAraA/78obd41yxdrRC+3auCcFUwqHMvgAekX3a/fHf6nICPFCegQuthepT/jDoCzi32Y5IcjoLtF/D6xz8w5CQ/rVB2HvuGGzp+eodQ5hmAGgL1tDVmfBoJyqntTnHcAqmZff5kEnHCmsy8+skzT2gdf8vWd+BpM5jIzgrS2dFBNB/DohKJ6QTFAa6+wqY9FYftNTO2jDcbhDj6JmGQg4300U+IQDtAe60H9cOMm5Rh6v0zcCclKb+ZaTT/VtQOx2IfJWSe35s4DA009LEAlZCkfzbvt6xKy2o4s3kgU4J2gCMTvcNUNy76iJ6/HYzxANh2fFDqOjEJnUxAgpHxTX0XNs8BzG50eprCSqa2inYyvHGSf6kNljbByx/fUP1TDfsuwXabr8qW/zWdn3Lu0D08ZHKuAChqt2Qp8G4phkDjfT98vLh7HZX2qWiBYe2YgAcOCsw="
language: ruby
dist: trusty
addons:
  postgresql: '9.6'
before_script:
  - curl -L https://codeclimate.com/downloads/test-reporter/test-reporter-latest-linux-amd64 > ./cc-test-reporter
  - chmod +x ./cc-test-reporter
  - "./cc-test-reporter before-build"
  - psql -c 'create database placecal_test;' -U postgres
before_install:
  - |
    if [ "$TRAVIS_BRANCH" = "production" ]; then
      openssl aes-256-cbc -k "$production_decrypt_key" -in $TRAVIS_BUILD_DIR/.travis/production-deploy.key.enc -out production-deploy.key -d
    elif [ "$TRAVIS_BRANCH" = "master" ]; then
      openssl aes-256-cbc -k "$staging_decrypt_key" -in $TRAVIS_BUILD_DIR/.travis/deploy.key.enc -out deploy.key -d
    fi
deploy:
  - provider: script
    skip_cleanup: true
    script: bash scripts/staging.sh
    on:
      branch: master
  - provider: script
    skip_cleanup: true
    script: bash scripts/production.sh
    on:
      branch: production
after_script:
  - "./cc-test-reporter after-build --exit-code $TRAVIS_TEST_RESULT"
